<!DOCTYPE html>
<html>
    <head>
        <title>Geo-Minesweeper</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script
            src="https://code.jquery.com/jquery-3.2.1.js"
            integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
        crossorigin="anonymous"></script>
        <style>
            .mscol{
                width: 1.2em;
                height: 1.2em;
                margin: 0;
                padding: 0;
                border: sienna solid thin;
            }
            .field{
                background-color: floralwhite;
            }
            .out{
                background-color: burlywood;
            }

            table{
                text-align: center;
                border: sienna solid thin;
                background-color: burlywood;
            }
        </style>
    </head>
    <body>
        <h3>Minesweeper</h3>
        <hr/>
        <table id="grid">
        </table>
        <hr />
        <!--<button type="submit" name="new_game" value="New Game" onclick="generateGrid({'width':10, 'height':10, 'id':'grid'})">New Game</button>-->
        Select country: <input type="text" name="country" id="country"/><br />
        Specify the number of grids: <input type="number" name="grid" id="ngrid"/><br/>
        <button type="submit" name="new_game" value="New Game" onclick="newGame()">New Game</button>
        <script type="text/javascript">
            function newGame() {
                $.get("StartGame?task=newGame&country="+$("#country").val()+"&grid="+$("#ngrid").val(), function (data) {
                    var j = JSON.parse(data);
                    var grid = j["grid"];
                    var table = "<table class='minesweeper'>";
                    for (var h = 0; h < grid.length; h++) {
                        table += "<tr class='msrow'>";
                        for (var w = 0; w < grid[0].length; w++) {
                            if ( grid[h][w] >= -99+10) {
                                table += "<td class='mscol field' id='x"+w+"y"+h+"' onclick='openGrid("+w+","+h+")'></td>";
                            }else {
                                table += "<td class='mscol out'></td>";
                            }
                        }
                        table += "</tr>";
                    }
                    table += "</table>";
                    $("#grid").html(table);
                });
            }
            function openGrid(x, y){
                $.get("StartGame?task=open&x="+x+"&y="+y, function (data) {
                    var j = JSON.parse(data);
                    var grid = j["grid"];
                    //if(grid[y][x]!=9){
                    //     $("#x"+y+"y"+x).html("HE"+grid[y][x]);
                    //}
                    console.log(grid);
                    for (var h = 0;h < grid.length; h++) {
                        for (var w = 0; w < grid[h].length; w++) {
                            if (grid[h][w] > 0) {
                                if(grid[h][w] == 9){
                                    $("#x"+w+"y"+h).css("background-color", "brown");
                                }else{
                                    $("#x"+w+"y"+h).html(grid[h][w]);
                                    console.log("hehe");
                                }
                            }else if (grid[h][w] >= -9 && grid[h][w] <0) {
                                $("#x"+w+"y"+h).css("background-color", "red");
                                $("#x"+w+"y"+h).html("X");
                            }
                        }
                    }
                });
            }
        </script>
    </body>
</html>
